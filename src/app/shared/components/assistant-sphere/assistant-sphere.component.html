<div class="sphere-wrapper fixed bottom-10 right-10 z-[1000] pointer-events-none">

    <!-- Draggable Sphere Container -->
    <!-- pointer-events-auto inside creates the interactive area -->
    <div class="sphere-container pointer-events-auto cursor-move relative flex flex-col items-end"
        [class.active]="isOpen" cdkDrag (click)="toggleOpen()">

        <!-- Popover Content (Knowledge Base) - Moves with Sphere -->
        <div *ngIf="isOpen"
            class="widget-popover absolute bottom-full right-0 mb-4 w-80 sm:w-96 transition-all duration-300 origin-bottom-right z-50 pointer-events-auto"
            (click)="$event.stopPropagation()" [class.animate-pop-in]="isOpen">
            <!-- stopPropagation prevents closing when clicking inside the widget -->
            <app-knowledge-base-widget [context]="currentContext$ | async"></app-knowledge-base-widget>
        </div>

        <!-- Orb Visual -->
        <!-- Orb Visual -->
        <div class="relative flex items-center justify-center shrink-0 p-2 cursor-pointer transition-transform hover:scale-105">
           <app-ai-core [isProcessing]="false"></app-ai-core>
        </div>
    </div>

</div>